# ppo_traits_with_self.sparql
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT
  ?trait
  ?trait_name
  (GROUP_CONCAT(?label ; SEPARATOR="|") AS ?mapped_traits)
WHERE {
  # ── leaf classes whose label ends with “present” or “absent”
  ?trait rdfs:label ?trait_name .
  FILTER ( STRENDS(LCASE(?trait_name), "present") || STRENDS(LCASE(?trait_name), "absent") )

    ?trait (rdfs:subClassOf)* ?anc .
    ?anc   rdfs:label ?anc_label .

    FILTER ( STRENDS(LCASE(?anc_label), "present") || STRENDS(LCASE(?anc_label), "absent") )
    FILTER ( ! STRENDS(LCASE(?anc_label), "presence") )

    BIND(?anc_label AS ?label)
}
GROUP BY ?trait ?trait_name

